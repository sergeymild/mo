{"code":"import { createAction, isAction, defineProperty, getDescriptor, objectPrototype, die, isFunction, recordAnnotationApplied, globalState, storedAnnotationsSymbol } from \"../internal\";\r\nexport function createActionAnnotation(name, options) {\r\n    return {\r\n        annotationType_: name,\r\n        options_: options,\r\n        make_,\r\n        extend_\r\n    };\r\n}\r\nfunction make_(adm, key) {\r\n    let annotated = false;\r\n    let source = adm.target_;\r\n    let bound = this.options_?.bound ?? false;\r\n    while (source && source !== objectPrototype) {\r\n        const descriptor = getDescriptor(source, key);\r\n        if (descriptor) {\r\n            // Instance or bound\r\n            // Keep first because the operation can be intercepted\r\n            // and we don't want to end up with partially annotated proto chain\r\n            if (source === adm.target_ || bound) {\r\n                const actionDescriptor = createActionDescriptor(adm, this, key, descriptor);\r\n                const definePropertyOutcome = adm.defineProperty_(key, actionDescriptor);\r\n                if (!definePropertyOutcome) {\r\n                    // Intercepted\r\n                    return;\r\n                }\r\n                annotated = true;\r\n                // Don't annotate protos if bound\r\n                if (bound) {\r\n                    break;\r\n                }\r\n            }\r\n            // Prototype\r\n            if (source !== adm.target_) {\r\n                if (isAction(descriptor.value)) {\r\n                    // A prototype could have been annotated already by other constructor,\r\n                    // rest of the proto chain must be annotated already\r\n                    annotated = true;\r\n                    break;\r\n                }\r\n                const actionDescriptor = createActionDescriptor(adm, this, key, descriptor, false);\r\n                defineProperty(source, key, actionDescriptor);\r\n                annotated = true;\r\n            }\r\n        }\r\n        source = Object.getPrototypeOf(source);\r\n    }\r\n    if (annotated) {\r\n        recordAnnotationApplied(adm, this, key);\r\n    }\r\n    else if (!adm.target_[storedAnnotationsSymbol]?.[key]) {\r\n        // Throw on missing key, except for decorators:\r\n        // Decorator annotations are collected from whole prototype chain.\r\n        // When called from super() some props may not exist yet.\r\n        // However we don't have to worry about missing prop,\r\n        // because the decorator must have been applied to something.\r\n        die(1, this.annotationType_, `${adm.name_}.${key.toString()}`);\r\n    }\r\n}\r\nfunction extend_(adm, key, descriptor, proxyTrap) {\r\n    const actionDescriptor = createActionDescriptor(adm, this, key, descriptor);\r\n    return adm.defineProperty_(key, actionDescriptor, proxyTrap);\r\n}\r\nfunction assertActionDescriptor(adm, { annotationType_ }, key, { value }) {\r\n    if (__DEV__ && !isFunction(value)) {\r\n        die(`Cannot apply '${annotationType_}' to '${adm.name_}.${key.toString()}':` +\r\n            `\\n'${annotationType_}' can only be used on properties with a function value.`);\r\n    }\r\n}\r\nfunction createActionDescriptor(adm, annotation, key, descriptor, \r\n// provides ability to disable safeDescriptors for prototypes\r\nsafeDescriptors = globalState.safeDescriptors) {\r\n    assertActionDescriptor(adm, annotation, key, descriptor);\r\n    let { value } = descriptor;\r\n    if (annotation.options_?.bound) {\r\n        value = value.bind(adm.proxy_ ?? adm.target_);\r\n    }\r\n    return {\r\n        value: createAction(annotation.options_?.name ?? key.toString(), value, annotation.options_?.autoAction ?? false),\r\n        // Non-configurable for classes\r\n        // prevents accidental field redefinition in subclass\r\n        configurable: safeDescriptors ? adm.isPlainObject_ : true,\r\n        // https://github.com/mobxjs/mobx/pull/2641#issuecomment-737292058\r\n        enumerable: false,\r\n        // Non-obsevable, therefore non-writable\r\n        // Also prevents rewriting in subclass constructor\r\n        writable: safeDescriptors ? false : true\r\n    };\r\n}\r\n//# sourceMappingURL=actionannotation.js.map","references":["/Users/sergeigolishnikov/development/web/mobx/packages/mobx/src/internal.ts"],"map":"{\"version\":3,\"file\":\"actionannotation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/types/actionannotation.ts\"],\"names\":[],\"mappings\":\"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\"}"}
